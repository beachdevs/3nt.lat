<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3nt.lat</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš¡</text></svg>">
    <style>
        :root {
            --bg: #ffffff;
            --text: #333333;
            --row-hover: #fafafa;
            --accent: #000000;
            --danger: #f44336;
            --font-size: 0.85rem;
        }
        [data-theme="dark"] {
            --bg: #121212;
            --text: #bbbbbb;
            --row-hover: #1a1a1a;
            --accent: #ffffff;
            --danger: #ff5252;
        }
        body {
            font-family: -apple-system, system-ui, sans-serif;
            font-size: var(--font-size);
            background: var(--bg);
            background-image: radial-gradient(circle at 50% 50%, rgba(128,128,128,0.03) 0%, transparent 100%);
            color: var(--text);
            transition: background 0.2s, color 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-top: 15vh;
            margin: 0;
        }
        .container { 
            width: 100%; 
            max-width: 700px; 
            display: flex;
            flex-direction: column;
            gap: 1.5rem; 
        }
        .card {
            background: var(--bg);
            padding: 1rem;
            border-radius: 8px;
            position: relative;
        }
        .cpu-header { display: flex; align-items: baseline; gap: 8px; margin-bottom: 0.5rem; }
        h2 { margin: 0; font-size: 1rem; font-weight: 600; }
        .cpu-info { font-size: 0.75rem; color: #888; opacity: 0; transition: opacity 0.2s; pointer-events: none; }
        .cpu-header:hover .cpu-info { opacity: 1; }
        
        .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; gap: 10px; }
        .add-site-box { display: flex; gap: 6px; flex-grow: 1; opacity: 0; pointer-events: none; transition: opacity 0.2s ease; }
        .card:hover .add-site-box { opacity: 1; pointer-events: auto; }
        .action-buttons { display: flex; gap: 8px; }
        .action-buttons button {
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: 400;
            background: none;
            border: none;
            box-shadow: none;
            transition: all 0.1s ease;
        }
        .action-buttons button:hover {
            background-color: var(--row-hover);
            transform: none;
            box-shadow: none;
        }
        .action-buttons button:active {
            opacity: 0.7;
        }
        .action-buttons button[onclick*="testAll"] {
            color: var(--accent);
        }
        .action-buttons button[onclick*="resetSites"] {
            color: #888;
            font-weight: 400;
        }
        .action-buttons button[onclick*="resetSites"]:hover {
            color: var(--text);
        }
        
        input {
            flex-grow: 1; padding: 6px 10px; border-radius: 4px; font-size: var(--font-size);
            border: none; background: var(--row-hover); color: var(--text);
        }
        input:focus { outline: none; }
        button {
            padding: 6px 12px; border-radius: 4px; border: none; cursor: pointer;
            background: none; color: var(--text); font-weight: 500; font-size: 0.8rem;
            display: flex; align-items: center; justify-content: center; gap: 4px;
            transition: background-color 0.2s;
        }
        button:hover { background-color: var(--row-hover); }
        
        .cpu-btn { position: absolute; top: 1rem; right: 1rem; }
        
        .site-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0 2rem;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 6px 10px; border: none; }
        th { font-weight: 600; color: #888; text-transform: uppercase; font-size: 0.7rem; letter-spacing: 0.05em; border-bottom: 1px solid var(--row-hover); }
        tr:hover { background: var(--row-hover); }
        .latency { font-family: ui-monospace, monospace; font-weight: 700; color: var(--text); font-size: 0.8rem; text-align: right; }
        .latency.good { color: #4caf50; }
        .latency.ok { color: #ff9800; }
        .latency.bad { color: var(--danger); }
        
        .remove-btn {
            color: var(--danger); cursor: pointer; font-size: 1rem;
            opacity: 0; transition: opacity 0.1s; padding: 0 4px;
        }
        tr:hover .remove-btn { opacity: 1; }
        
        #cpu-result { font-family: ui-monospace, monospace; font-size: 0.8rem; margin-top: 1rem; padding: 6px 12px; border-radius: 4px; display: inline-block; }
        #cpu-result.good { color: #4caf50; }
        #cpu-result.bad { color: var(--danger); }
        
        .top-nav { position: absolute; top: 1rem; right: 1rem; display: flex; gap: 4px; }
        .nav-btn { background: none; color: var(--text); border: none; font-size: 0.8rem; padding: 4px 10px; border-radius: 4px; cursor: pointer; opacity: 0.5; transition: opacity 0.2s; }
        .nav-btn:hover { opacity: 1; background-color: var(--row-hover); }
        
        footer { margin-top: 1rem; text-align: center; font-size: 0.6rem; color: #888; opacity: 0; padding-bottom: 2rem; transition: opacity 0.3s ease; }
        footer:hover { opacity: 0.5; }
        footer a { color: inherit; text-decoration: none; transition: color 0.2s; }
        footer a:hover { color: var(--text); }
    </style>
</head>
<body>

<div class="top-nav">
    <button class="nav-btn" onclick="sharePage()" title="Share">âŽ‹</button>
    <button class="nav-btn" onclick="toggleTheme()" title="Toggle Theme">ðŸŒ“</button>
</div>

<div class="container">
    <div class="card">
        <div class="top-row">
            <div class="add-site-box">
                <input type="text" id="site-input" placeholder="Add Site" onkeypress="if(event.key === 'Enter') addSite()">
                <button onclick="addSite()" title="Add Site">ï¼‹</button>
            </div>
            <div class="action-buttons">
                <button onclick="testAll()" title="Run All Tests">Â» Run All</button>
                <button onclick="resetSites()" title="Reset Defaults">âŽŒ Reset Site List</button>
            </div>
        </div>
        <div class="site-grid">
            <table id="table-left">
                <thead>
                    <tr><th>Target</th><th style="text-align:right"></th><th style="width:15px"></th></tr>
                </thead>
                <tbody id="tbody-left"></tbody>
            </table>
            <table id="table-right">
                <thead>
                    <tr><th>Target</th><th style="text-align:right"></th><th style="width:15px"></th></tr>
                </thead>
                <tbody id="tbody-right"></tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <div class="cpu-header">
            <h2>CPU Speed Test</h2>
            <span class="cpu-info">primes to 1m</span>
        </div>
        <button class="cpu-btn" onclick="testCPU()" title="Start Benchmark">âš¡ Run</button>
        <div id="cpu-result">Ready</div>
    </div>

    <footer><a href="https://x.com/sunsetbeachlabs" target="_blank">c 2026 sunset beach labs</a></footer>
</div>

<script>
    const DEFAULT_SITES = [
        'https://google.com', 'https://cloudflare.com', 'https://httpbin.org',
        'https://github.com', 'https://amazon.com', 'https://facebook.com',
        'https://apple.com', 'https://microsoft.com', 'https://netflix.com',
        'https://twitter.com', 'https://wikipedia.org', 'https://youtube.com'
    ];
    let sites = JSON.parse(localStorage.getItem('latency_sites')) || [...DEFAULT_SITES];

    function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        body.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
    }

    if (localStorage.getItem('theme') === 'dark') {
        document.body.setAttribute('data-theme', 'dark');
    }

    function save() { localStorage.setItem('latency_sites', JSON.stringify(sites)); }

    async function sharePage() {
        try {
            await navigator.share({
                title: '3nt.lat | Web Latency & CPU Tester',
                text: 'Check your web latency and CPU performance with this minimalist tool.',
                url: window.location.href
            });
        } catch (err) {
            // Fallback: copy to clipboard if share API is not supported or cancelled
            if (err.name !== 'AbortError') {
                navigator.clipboard.writeText(window.location.href);
                const shareBtn = document.querySelector('.nav-btn[title="Share"]');
                const originalText = shareBtn.textContent;
                shareBtn.textContent = 'âœ“';
                setTimeout(() => shareBtn.textContent = originalText, 2000);
            }
        }
    }

    function render() {
        const left = document.getElementById('tbody-left');
        const right = document.getElementById('tbody-right');
        left.innerHTML = '';
        right.innerHTML = '';
        
        sites.forEach((site, index) => {
            const displayUrl = site.replace(/^https?:\/\//, '').replace('www.', '').split('/')[0];
            const html = `
                <tr>
                    <td title="${site}">${displayUrl}</td>
                    <td class="latency" id="latency-${index}">-</td>
                    <td><span class="remove-btn" onclick="removeSite(${index})" title="Remove">&times;</span></td>
                </tr>
            `;
            if (index < Math.ceil(sites.length / 2)) {
                left.innerHTML += html;
            } else {
                right.innerHTML += html;
            }
        });
    }

    function addSite() {
        const input = document.getElementById('site-input');
        let url = input.value.trim();
        if (!url) return;
        if (!url.startsWith('http')) url = 'https://' + url;
        
        if (sites.includes(url)) {
            input.value = '';
            input.placeholder = 'Already added';
            setTimeout(() => input.placeholder = 'Add Site', 1000);
            return;
        }

        sites.push(url);
        input.value = '';
        save();
        render();
    }

    function removeSite(index) {
        sites.splice(index, 1);
        save();
        render();
    }

    function resetSites() {
        sites = [...DEFAULT_SITES];
        save();
        render();
    }

    async function testLatency(url, index) {
        const el = document.getElementById(`latency-${index}`);
        el.textContent = '...';
        el.className = 'latency';
        
        const start = performance.now();
        try {
            await fetch(url, { mode: 'no-cors', cache: 'no-cache' });
            const end = performance.now();
            const ms = Math.round(end - start);
            el.textContent = ms + 'ms';
            
            if (ms < 100) el.classList.add('good');
            else if (ms < 300) el.classList.add('ok');
            else el.classList.add('bad');
        } catch (e) {
            el.textContent = 'err';
            el.classList.add('bad');
        }
    }

    function testAll() {
        sites.forEach((site, index) => testLatency(site, index));
    }

    function testCPU() {
        const resultEl = document.getElementById('cpu-result');
        resultEl.textContent = '...';
        resultEl.className = '';
        setTimeout(() => {
            const start = performance.now();
            for (let i = 2; i <= 1000000; i++) {
                let isPrime = true;
                for (let j = 2; j <= Math.sqrt(i); j++) {
                    if (i % j === 0) { isPrime = false; break; }
                }
            }
            const end = performance.now();
            const ms = Math.round(end - start);
            resultEl.textContent = `${ms}ms`;
            if (ms < 100) resultEl.className = 'good';
            else if (ms > 200) resultEl.className = 'bad';
        }, 50);
    }

    render();
</script>

</body>
</html>
